// File: sentiric-contracts/proto/sentiric/user/v1/user.proto

syntax = "proto3";

package sentiric.user.v1;

import "google/protobuf/field_mask.proto";

option go_package = "github.com/sentiric/sentiric-contracts/gen/go/sentiric/user/v1;userv1";

// =================================================================
//                            DATA MODELS
// =================================================================

message Contact {
  int32 id = 1;
  string user_id = 2;
  string contact_type = 3;
  string contact_value = 4;
  bool is_primary = 5;
}

message User {
  string id = 1;
  optional string name = 2;
  string tenant_id = 3;
  string user_type = 4;
  repeated Contact contacts = 5;
  optional string preferred_language_code = 6;
}

message Tenant {
  string id = 1;
  string name = 2;
  string domain = 3;
  string primary_language_code = 4;
}

// =================================================================
//                          SERVICE DEFINITION
// =================================================================

service UserService {
  // Temel okuma operasyonları
  rpc GetUser(GetUserRequest) returns (GetUserResponse);
  rpc FindUserByContact(FindUserByContactRequest) returns (FindUserByContactResponse);

  // Yazma ve yönetim operasyonları
  rpc CreateUser(CreateUserRequest) returns (CreateUserResponse);
  rpc UpdateUser(UpdateUserRequest) returns (UpdateUserResponse);
  rpc DeleteUser(DeleteUserRequest) returns (DeleteUserResponse);

  // Kontak yönetimi
  rpc AddContact(AddContactRequest) returns (AddContactResponse);
  rpc UpdateContact(UpdateContactRequest) returns (UpdateContactResponse);
  rpc DeleteContact(DeleteContactRequest) returns (DeleteContactResponse);

  // --- YENİ SIP YÖNETİM RPC'LERİ ---
  // Kimlik doğrulama için SIP bilgilerini getirir
  rpc GetSipCredentials(GetSipCredentialsRequest) returns (GetSipCredentialsResponse);
  // Bir kullanıcı için yeni bir SIP kimliği oluşturur
  rpc CreateSipCredential(CreateSipCredentialRequest) returns (CreateSipCredentialResponse);
  // Bir SIP kimliğini siler
  rpc DeleteSipCredential(DeleteSipCredentialRequest) returns (DeleteSipCredentialResponse);
}

// =================================================================
//                         RPC MESSAGES
// =================================================================

// --- GetUser ---
message GetUserRequest {
  string user_id = 1;
}
message GetUserResponse {
  User user = 1;
}

// --- FindUserByContact ---
message FindUserByContactRequest {
  string contact_type = 1;
  string contact_value = 2;
}
message FindUserByContactResponse {
  User user = 1;
}

// --- CreateUser ---
message CreateUserRequest {
  string tenant_id = 1;
  string user_type = 2;
  optional string name = 3;
  message InitialContact {
    string contact_type = 1;
    string contact_value = 2;
  }
  InitialContact initial_contact = 4;
  optional string preferred_language_code = 5;
}
message CreateUserResponse {
  User user = 1;
}

// --- UpdateUser ---
message UpdateUserRequest {
  User user = 1;
  google.protobuf.FieldMask update_mask = 2; // Hangi alanların güncelleneceğini belirtir
}
message UpdateUserResponse {
  User user = 1;
}

// --- DeleteUser ---
message DeleteUserRequest {
  string user_id = 1;
}
message DeleteUserResponse {
  bool success = 1;
}

// --- AddContact ---
message AddContactRequest {
  string user_id = 1;
  Contact contact = 2;
}
message AddContactResponse {
  User user = 1; // Kullanıcının güncel halini döndürür
}

// --- UpdateContact ---
message UpdateContactRequest {
  Contact contact = 1;
  google.protobuf.FieldMask update_mask = 2;
}
message UpdateContactResponse {
  User user = 1;
}

// --- DeleteContact ---
message DeleteContactRequest {
  int32 contact_id = 1;
}
message DeleteContactResponse {
  User user = 1;
}

// --- GetSipCredentials ---
message GetSipCredentialsRequest {
  string sip_username = 1;
  string realm = 2; // <-- YENİ ALAN
}
message GetSipCredentialsResponse {
  string user_id = 1;
  string tenant_id = 2;
  string ha1_hash = 3;
}

// --- YENİ MESAJLAR ---
// --- CreateSipCredential ---
message CreateSipCredentialRequest {
  string user_id = 1;
  string sip_username = 2;
  string password = 3;
}
message CreateSipCredentialResponse {
  bool success = 1;
}

// --- DeleteSipCredential ---
message DeleteSipCredentialRequest {
  string sip_username = 1;
}
message DeleteSipCredentialResponse {
  bool success = 1;
}

// proto/sentiric/sip/v1/proxy_service.proto

syntax = "proto3";

package sentiric.sip.v1;

option go_package = "github.com/sentiric/sentiric-contracts/gen/go/sentiric/sip/v1;sipv1";

// =================================================================
// ğŸ›¡ï¸ Proxy Service (SIP YÃ¶nlendirici)
// Gelen SIP isteklerinin nereye gideceÄŸine karar verir.
// =================================================================

service ProxyService {
  rpc GetNextHop(GetNextHopRequest) returns (GetNextHopResponse);
}

message GetNextHopRequest {
  // Hedef URI (Request-URI)
  // Ã–rn: sip:1001@sentiric_demo veya sip:b2bua@10.88.30.8:13084
  string destination_uri = 1;

  // Ä°steÄŸi gÃ¶nderen kaynaÄŸÄ±n IP adresi
  string source_ip = 2;

  // SIP Metodu (INVITE, ACK, BYE, REGISTER vb.)
  string method = 3;

  // ArayanÄ±n kimliÄŸi (From header'dan ayÄ±klanÄ±r)
  string from_uri = 4;
  
  // [v1.17.0 EKLENDÄ°]
  // Bu isteÄŸin devam eden bir diyalog (ACK, BYE) iÃ§inde olup olmadÄ±ÄŸÄ±nÄ± belirtir.
  // EÄŸer 'true' ise, Dialplan sorgusu atlanÄ±r ve yÃ¶nlendirme doÄŸrudan yapÄ±lÄ±r.
  bool is_in_dialog = 5;
}

message GetNextHopResponse {
  // Bir sonraki hedefin SIP adresi (IP:Port veya FQDN:Port)
  // Ã–rn: 10.88.30.8:13084
  string uri = 1;

  // YÃ¶nlendirme kararÄ±nÄ±n kaynaÄŸÄ± (debug iÃ§in)
  // Ã–rn: "sentiric-ai-gateway", "direct-route-in-dialog"
  string gateway_id = 2;
}
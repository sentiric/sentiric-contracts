syntax = "proto3";

package sentiric.tts.v1;

option go_package = "github.com/sentiric/sentiric-contracts/gen/go/sentiric/tts/v1;ttsv1";

// =============================================================================
// TTS GATEWAY SERVICE (PUBLIC FACING)
// v1.16.0: Sample Rate ve Tuning Parametreleri Eklendi
// =============================================================================

service TtsGatewayService {
  rpc Synthesize(SynthesizeRequest) returns (SynthesizeResponse);
  rpc SynthesizeStream(SynthesizeStreamRequest) returns (stream SynthesizeStreamResponse);
  rpc ListVoices(ListVoicesRequest) returns (ListVoicesResponse);
}

// =============================================================================
// RPC MESAJLARI
// =============================================================================

message SynthesizeRequest {
  string text = 1;
  TextType text_type = 2;
  string voice_id = 3;
  // [MİMARİ KARAR]: AudioConfig zorunludur. Her istek format ve sample rate belirtmelidir.
  AudioConfig audio_config = 4;
  string preferred_provider = 5;
  // [MİMARİ KARAR]: İnce ayar parametreleri opsiyonel bir alt mesaj olarak eklendi.
  optional TuningParams tuning = 6;
  optional bytes cloning_audio_data = 7;
}

message SynthesizeResponse {
  bytes audio_content = 1;
  string content_type = 2;
  string provider_used = 3;
}

message SynthesizeStreamRequest {
  string text = 1;
  TextType text_type = 2;
  string voice_id = 3;
  // [MİMARİ KARAR]: AudioConfig zorunludur.
  AudioConfig audio_config = 4;
  string preferred_provider = 5;
  // [MİMARİ KARAR]: İnce ayar parametreleri opsiyonel bir alt mesaj olarak eklendi.
  optional TuningParams tuning = 6;
  optional bytes cloning_audio_data = 7;
}

message SynthesizeStreamResponse {
  bytes audio_content = 1;
  string content_type = 2;
  string provider_used = 3;
}

message ListVoicesRequest { string language_code = 1; }
message ListVoicesResponse { repeated VoiceInfo voices = 1; }

// =============================================================================
// YARDIMCI TİPLER & ENUMLAR
// =============================================================================

// [YENİ MESAJ]: Ses üretiminin ince ayarlarını kontrol eder.
message TuningParams {
    float temperature = 1;       // Rastgelelik: Yüksek değerler daha yaratıcı, düşük değerler daha deterministik. (0.0-2.0)
    float top_p = 2;             // Nucleus sampling: Olasılık eşiği. (0.0-1.0)
    int32 top_k = 3;             // En olası K token arasından seçim yap.
    float repetition_penalty = 4; // Tekrar eden kelimeleri cezalandır. (1.0+)
    float speed = 5;              // Konuşma hızı. (0.25-4.0)
}

enum TextType {
  TEXT_TYPE_UNSPECIFIED = 0;
  TEXT_TYPE_TEXT = 1;
  TEXT_TYPE_SSML = 2;
}

enum AudioFormat {
  AUDIO_FORMAT_UNSPECIFIED = 0;
  AUDIO_FORMAT_PCM_S16LE = 1;
  AUDIO_FORMAT_WAV = 2;
  AUDIO_FORMAT_MP3 = 3;
  AUDIO_FORMAT_OGG_OPUS = 4;
  AUDIO_FORMAT_MULAW = 5;
}

message AudioConfig {
  AudioFormat audio_format = 1;
  int32 sample_rate_hertz = 2;
  double volume_gain_db = 3;
}

// ProsodyConfig eski versiyonlarla uyumluluk için tutuluyor,
// ancak yeni sistemler TuningParams kullanmalı.
message ProsodyConfig {
  double rate = 1;
  double pitch = 2;
  string emotion = 3;
}

message VoiceInfo {
  string id = 1;
  string name = 2;
  string language = 3;
  string gender = 4;
  repeated string styles = 5;
}
syntax = "proto3";

package sentiric.telephony.v1;

import "sentiric/event/v1/event.proto"; // MediaInfo için

option go_package = "github.com/sentiric/sentiric-contracts/gen/go/sentiric/telephony/v1;telephonyv1";

service TelephonyActionService {
  rpc PlayAudio(PlayAudioRequest) returns (PlayAudioResponse);
  rpc TerminateCall(TerminateCallRequest) returns (TerminateCallResponse);
  rpc SendTextMessage(SendTextMessageRequest) returns (SendTextMessageResponse);
  rpc StartRecording(StartRecordingRequest) returns (StartRecordingResponse);
  rpc StopRecording(StopRecordingRequest) returns (StopRecordingResponse);

  // Gerçek zamanlı ses işleme boru hattı
  rpc RunPipeline(RunPipelineRequest) returns (stream RunPipelineResponse);

  // [YENİ] Metni sese çevirip çalma (Agent Service yükünü almak için)
  rpc SpeakText(SpeakTextRequest) returns (SpeakTextResponse);
}

message RunPipelineRequest {
  string call_id = 1;
  string session_id = 2;
  // Hangi AI modellerinin kullanılacağı
  string stt_model_id = 3; 
  string tts_model_id = 4;
  bool record_session = 5;
  
  // Medya bağlantı bilgileri
  sentiric.event.v1.MediaInfo media_info = 6;
}

message RunPipelineResponse {
  enum State {
    STATE_UNSPECIFIED = 0;
    STATE_STARTING = 1;
    STATE_RUNNING = 2;
    STATE_STOPPED = 3;
    STATE_ERROR = 4;
  }
  State state = 1;
  string message = 2;
}

// --- SpeakText Messages ---
message SpeakTextRequest {
  string call_id = 1;
  string text = 2;
  string voice_id = 3; // örn: "coqui:default"
  // Sesin nereye basılacağı bilgisi
  sentiric.event.v1.MediaInfo media_info = 4; 
}

message SpeakTextResponse {
  bool success = 1;
  string message = 2;
}

// --- Diğer Mesajlar ---
message PlayAudioRequest { 
  string call_id = 1; 
  string audio_uri = 2; 
}

message PlayAudioResponse { 
  bool success = 1; 
}

message TerminateCallRequest { 
  string call_id = 1; 
  string reason = 2; 
}

message TerminateCallResponse { 
  bool success = 1; 
}

message SendTextMessageRequest { 
  string to = 1; 
  string body = 2; 
}

message SendTextMessageResponse { 
  bool success = 1; 
}

message StartRecordingRequest { 
  string call_id = 1; 
  string output_uri = 2; 
}

message StartRecordingResponse { 
  bool success = 1; 
}

message StopRecordingRequest { 
  string call_id = 1; 
}

message StopRecordingResponse { 
  bool success = 1; 
}